<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Meeting Notes Summarizer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #f4f6f8;
      color: #333;
    }
    textarea, input[type="text"], input[type="email"] {
      width: 100%;
      padding: 10px;
      margin: 0.5rem 0 1rem 0;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      background: #007bff;
      border: none;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:disabled {
      background: #999;
      cursor: not-allowed;
    }
    button:hover:enabled {
      background: #0056b3;
    }
    #summary {
      min-height: 150px;
      border: 1px solid #ddd;
      background: #fff;
      padding: 10px;
      white-space: pre-wrap;
      overflow: auto;
    }
    .muted {
      color: #666;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>AI Meeting Notes Summarizer</h1>

  <!-- File Upload -->
  <label for="fileInput">Upload meeting notes:</label>
  <input type="file" id="fileInput">
  <button id="uploadBtn">Upload</button>

  <!-- Transcript -->
  <h3>Transcript:</h3>
  <textarea id="transcript" placeholder="Paste transcript here..."></textarea>

  <!-- Custom instruction -->
  <label for="prompt">Custom instruction (optional):</label>
  <input id="prompt" type="text" placeholder="e.g., Summarize in bullets or highlight action items">

  <!-- Summarize -->
  <button id="summarizeBtn">Generate Summary</button>
  <span id="genStatus" class="muted"></span>

  <!-- Summary output -->
  <h3>Summary:</h3>
  <div id="summary"></div>

  <!-- Email -->
  <h3>Send Summary via Email:</h3>
  <input id="emails" type="text" placeholder="Recipient emails, comma-separated">
  <input id="subject" type="text" placeholder="Email subject (optional)">
  <button id="sendBtn">Send Email</button>
  <span id="sendStatus" class="muted"></span>

  <hr>
  <p class="muted">Backend health: <span id="health">checking…</span></p>

  <script>
    const fileInput = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");
    const transcriptEl = document.getElementById("transcript");
    const promptEl = document.getElementById("prompt");
    const summarizeBtn = document.getElementById("summarizeBtn");
    const summaryEl = document.getElementById("summary");
    const genStatus = document.getElementById("genStatus");
    const emailsEl = document.getElementById("emails");
    const subjectEl = document.getElementById("subject");
    const sendBtn = document.getElementById("sendBtn");
    const sendStatus = document.getElementById("sendStatus");
    const healthEl = document.getElementById("health");

    // Load file
    uploadBtn.addEventListener("click", async () => {
      const file = fileInput.files?.[0];
      if (!file) { alert("Please select a file first."); return; }
      const text = await file.text();
      transcriptEl.value = text;
    });

    // Generate summary
    summarizeBtn.addEventListener("click", async () => {
      const text = transcriptEl.value.trim();
      const prompt = promptEl.value.trim();
      if (!text) { alert("Please upload or paste a transcript."); return; }

      genStatus.textContent = "Generating…";
      summarizeBtn.disabled = true;

      try {
        const res = await fetch("/api/summarize", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text, prompt })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "Failed to summarize");

        summaryEl.innerText = data.summary || "No summary generated.";
        genStatus.textContent = "Done.";
      } catch (err) {
        console.error(err);
        genStatus.textContent = "Error generating summary.";
        summaryEl.innerText = "Error generating summary.";
      } finally {
        summarizeBtn.disabled = false;
      }
    });

    // Send email
    sendBtn.addEventListener("click", async () => {
      const summary = summaryEl.innerText.trim();
      const to = emailsEl.value.trim();
      const subject = subjectEl.value.trim();
      if (!summary || !to) { alert("Provide recipient emails and summary."); return; }

      sendStatus.textContent = "Sending…";
      sendBtn.disabled = true;

      try {
        const res = await fetch("/api/send", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ to, subject, summary })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "Failed to send email");

        sendStatus.textContent = "Email sent ✔";
      } catch (err) {
        console.error(err);
        sendStatus.textContent = "Error sending email.";
      } finally {
        sendBtn.disabled = false;
      }
    });

    // Check backend health
    (async () => {
      try {
        const res = await fetch("/api/health");
        const data = await res.json();
        healthEl.textContent = data.ok ? "OK" : "Not OK";
      } catch {
        healthEl.textContent = "Unavailable";
      }
    })();
  </script>
</body>
</html>
